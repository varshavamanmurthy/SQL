with cte as(
SELECT
        *,
        DENSE_RANK() OVER(PARTITION BY SCHOOL_ID ORDER BY student_count  DESC) AS RANK1
FROM schools CROSS JOIN Exam
WHERE student_count <= capacity 
ORDER BY SCHOOL_ID),

cte2 as (
SELECT
        school_id, 
        min(score) as score
FROM cte 
where rank1 = 1
group by school_id)

SELECT 
        *
FROM CTE2

UNION

SELECT 
      school_id,
      -1 as score
FROM schools
WHERE school_id not in (select school_id from cte2)
